<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Archive: The Giant Tree</title>
    <style>
        /* --- 1. Âü∫Á°ÄËßÜËßâËÆæÁΩÆ --- */
        :root {
            --font-main: "Helvetica Neue", Helvetica, Arial, sans-serif;
            --font-mono: "Courier New", Courier, monospace;
            --color-bg: #ffffff;
            --color-text: #000000;
            --color-line: #e0e0e0;
            --sidebar-width: 320px;
            --trans-speed: 0.8s;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--color-bg);
            color: var(--color-text);
            font-size: 13px;
            line-height: 1.4;
            height: 100vh;
            overflow: hidden;
            cursor: crosshair;
            transition: background-color var(--trans-speed);
        }

        /* --- 2. ÂûÉÂúæÂú∫Ê®°Âºè --- */
        body.mode-chaos { 
            background-color: #dcdcdc; /* Êõ¥Ê∑±‰∏ÄÁÇπÁöÑÁÅ∞ÔºåË°¨ÊâòÊ†ë */
            overflow: hidden; 
        }
        
        /* Âô™ÁÇπÂ±Ç */
        #noise-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; opacity: 0.08; z-index: 9000;
            mix-blend-mode: multiply;
        }

        /* --- ÁîüÁâ©Â±Ç --- */
        #bio-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; 
            z-index: 1; 
            opacity: 0;
            transition: opacity 2s ease;
            mix-blend-mode: multiply;
        }
        body.mode-chaos #bio-layer { opacity: 1; }

        /* SVG Ê†ëÔºöÂÖ®Â±èË¶ÜÁõñ */
        #tree-svg {
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        /* Â†ÜÂè†Â±Ç & Âä®ÁîªÂ±Ç */
        #pile-canvas, #leaf-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        #pile-canvas { z-index: 6; }
        #leaf-canvas { z-index: 7; }

        /* --- 3. Â∏ÉÂ±ÄÁªìÊûÑ --- */
        #app { display: flex; width: 100%; height: 100%; position: relative; z-index: 10; }
        
        aside {
            width: var(--sidebar-width); border-right: 1px solid var(--color-text);
            display: flex; flex-direction: column; background: #fff; flex-shrink: 0; z-index: 20;
            transition: transform var(--trans-speed) cubic-bezier(0.2, 1, 0.2, 1);
        }
        body.mode-chaos aside { transform: translateX(-280px); opacity: 0.9; }

        .nav-tree { flex: 1; overflow-y: auto; }
        
        .acc-item { border-bottom: 1px solid var(--color-line); }
        .acc-header { 
            padding: 16px; cursor: pointer; display: flex; justify-content: space-between; 
            font-weight: bold; text-transform: uppercase; 
        }
        .acc-header:hover { background-color: #f5f5f5; }
        .acc-body { display: none; }
        .acc-item.open .acc-body { display: block; }
        
        .college-item { 
            padding: 12px 16px 12px 32px; cursor: pointer; 
            border-bottom: 1px solid var(--color-line); 
            display: flex; justify-content: space-between; color: #555; 
        }
        .college-item:hover { color: #000; text-decoration: underline; }
        .college-item.active { background-color: #000; color: #fff; text-decoration: none; }

        /* --- 4. ËÉΩÈáèÊéßÂà∂Âè∞ --- */
        .energy-control {
            margin-top: auto; border-top: 1px solid var(--color-text); padding: 20px; background: #fff;
            position: relative; right: 0;
        }
        body.mode-chaos .energy-control { background: #000; color: #fff; border-color: #fff; }
        
        .energy-display { font-family: var(--font-mono); font-size: 11px; margin-bottom: 12px; }
        .energy-val { font-weight: bold; font-size: 14px; }
        .switch-btn {
            width: 100%; padding: 10px; border: 1px solid currentColor; background: transparent; color: inherit;
            font-weight: bold; text-transform: uppercase; cursor: pointer; display: flex; justify-content: space-between;
            transition: all 0.3s;
        }
        .switch-indicator { width: 10px; height: 10px; border-radius: 50%; border: 1px solid currentColor; position: relative; }
        body.mode-chaos .switch-indicator { background: #ff0000; border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }

        /* --- 5. ‰∏ªÂÜÖÂÆπÂå∫ --- */
        main { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        
        .content-header {
            padding: 16px; border-bottom: 1px solid var(--color-text); height: 120px;
            display: flex; flex-direction: column; justify-content: space-between; background: #fff;
            transition: all var(--trans-speed); z-index: 5;
        }
        body.mode-chaos .content-header { transform: translateY(-150px); opacity: 0; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; font-size: 11px; margin-top: auto; }
        .stat-box strong { display: block; font-size: 16px; font-weight: normal; font-family: var(--font-mono); }

        .data-table-header {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 12px 16px;
            border-bottom: 1px solid var(--color-text); font-weight: bold; font-size: 11px; text-transform: uppercase;
            position: sticky; top: 0; background: #fff; z-index: 5;
            transition: opacity var(--trans-speed);
        }
        body.mode-chaos .data-table-header { opacity: 0; pointer-events: none; }

        .data-container { flex: 1; overflow-y: auto; position: relative; perspective: 1000px; }
        #data-list { padding-bottom: 100px; transition: all var(--trans-speed); }

        .data-row {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; padding: 16px;
            border-bottom: 1px solid var(--color-line); background: #fff;
            transition: transform var(--trans-speed) cubic-bezier(0.2, 1, 0.2, 1), opacity 0.5s;
            position: relative;
            transform-origin: center center;
        }
        .cell-emission { font-family: var(--font-mono); font-weight: bold; }
        
        body:not(.mode-chaos) .data-row:hover { background-color: #000; color: #fff; z-index: 10; }

        @keyframes nervous-shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        body.mode-chaos #data-list { display: block; padding-top: 50px; }
        body.mode-chaos .data-row {
            border: 1px solid #000; margin-bottom: -15px; background: #fff; color: #000;
            width: 85%; margin-left: 7.5%;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
            animation: nervous-shake 2.5s infinite;
            text-shadow: 2px 0 rgba(255,0,0,0.5), -2px 0 rgba(0,0,255,0.5);
            pointer-events: none; 
        }

        /* --- 7. ËßÜËßâÊÇ¨ÊµÆÂç°Áâá --- */
        #hover-card {
            position: fixed; top: 0; left: 0; width: 240px;
            background: #fff; border: 1px solid #000;
            box-shadow: 10px 10px 0 rgba(0,0,0,0.2);
            padding: 10px; pointer-events: none; z-index: 9999;
            opacity: 0; transform: scale(0.9) translateY(10px);
            transition: opacity 0.2s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column; align-items: center;
        }
        #hover-card.visible { opacity: 1; transform: scale(1) translateY(0); }

        .card-image-box {
            width: 100%; height: 160px; background: #f0f0f0; margin-bottom: 10px;
            border: 1px solid #eee; display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }
        /* SVG ÂõæÁâáÊ†∑Âºè‰ºòÂåñ */
        .card-image-box img { width: 100%; height: 100%; object-fit: contain; padding: 20px; }
        .card-text { font-family: var(--font-mono); font-size: 11px; text-align: center; line-height: 1.4; color: #000; }
        .card-highlight { font-weight: bold; font-size: 14px; display: block; margin-bottom: 4px;}

        /* --- 8. ÂûÉÂúæÂ±Ç --- */
        #trash-container { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:50; }
        .trash-item { position: absolute; mix-blend-mode: multiply; transition: top 1s; }
        .trash-item svg { fill: #fff; stroke: #000; stroke-width: 1.5px; }
        
        .empty-state { height: 100%; display: flex; align-items: center; justify-content: center; color: #999; }

    </style>
</head>
<body>

    <canvas id="noise-canvas"></canvas>

    <div id="bio-layer">
        <canvas id="pile-canvas"></canvas> <canvas id="leaf-canvas"></canvas> <svg id="tree-svg"></svg>          </div>

    <div id="hover-card">
        <div class="card-image-box"><img id="card-img" src="" alt="Equivalent"></div>
        <div class="card-text"><span class="card-highlight" id="card-val"></span><span id="card-desc"></span></div>
    </div>

    <div id="app">
        <aside>
            <div style="padding:16px; border-bottom:1px solid #000;">
                <input type="text" id="search-input" placeholder="Search archive..." style="width:100%; padding:8px; border:1px solid #000;">
            </div>
            <div class="nav-tree" id="nav-tree"></div>
            <div class="energy-control">
                <div class="energy-display">
                    <div>SESSION ENERGY</div>
                    <div class="energy-val" id="energy-joules">0.00 J</div>
                    <div class="energy-val" id="energy-carbon" style="color:#666;font-size:12px;">0.00 gCO‚ÇÇe</div>
                    <div class="energy-label" id="trash-count-label">Leaves: 0 | Tree Health: 100%</div>
                </div>
                <button class="switch-btn" id="mode-toggle">
                    <span id="mode-text">Enter Landfill</span>
                    <div class="switch-indicator"></div>
                </button>
            </div>
        </aside>

        <main id="main-content">
            <div id="content-header-wrapper" class="content-header">
                <div class="empty-state">Select a category on the left.</div>
            </div>
            <div class="data-table-header">
                <div>Item Name</div><div>Value / Emission</div><div>Date</div><div>Context</div>
            </div>
            <div class="data-container" id="scroll-container">
                <div id="data-list"></div>
                <div id="trash-container"></div>
                <div class="empty-state" id="empty-state" style="opacity:0;"></div>
            </div>
        </main>
    </div>

<script>
    // 0. ÂÆåÊï¥Êï∞ÊçÆÈõÜ (Â∑≤ÂÆåÂÖ®ÊÅ¢Â§ç)
    const RAW_DATA = [
        // --- Network ---
        {"category": "Network and telephony", "college": "LCF", "name": "Routers", "emission": 0.3598, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CSM", "name": "Switches", "emission": 49.3679, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCF", "name": "Switches", "emission": 116.6569, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCC", "name": "Switches", "emission": 60.1882, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CCW", "name": "Switches", "emission": 54.9471, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CSM", "name": "Wireless Network", "emission": 7.8009, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCF", "name": "Wireless Network", "emission": 10.0713, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCC", "name": "Wireless Network", "emission": 5.9749, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CCW", "name": "Wireless Network", "emission": 23.194, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CSM", "name": "LAN 10GBBASET-t Ethernet", "emission": 2.8403, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCF", "name": "LAN 10GBBASET-t Ethernet", "emission": 6.7118, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCC", "name": "LAN 10GBBASET-t Ethernet", "emission": 3.4629, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CCW", "name": "LAN 10GBBASET-t Ethernet", "emission": 3.1613, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "CSM", "name": "Optical Fibre", "emission": 61.6792, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Network and telephony", "college": "LCF", "name": "Optical Fibre", "emission": 138.0162, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        // --- Cloud ---
        {"category": "Cloud, storage and hosting", "college": "LCC", "name": "PUE Rating for Facility", "emission": 1.6, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Cloud, storage and hosting", "college": "LCC", "name": "High Specification / GPU Servers", "emission": 0.8071, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Cloud, storage and hosting", "college": "CSM", "name": "High Specification / GPU Servers", "emission": 1.6144, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Cloud, storage and hosting", "college": "LCF", "name": "High Specification / GPU Servers", "emission": 2.8251, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Cloud, storage and hosting", "college": "LCC", "name": "Data Storage Servers", "emission": 1.2848, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Cloud, storage and hosting", "college": "LCC", "name": "HDD", "emission": 8.8801, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Cloud, storage and hosting", "college": "LCC", "name": "Data Storage Servers", "emission": 2.72, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Cloud, storage and hosting", "college": "CSM", "name": "Data Storage Servers", "emission": 1.84, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Cloud, storage and hosting", "college": "LCF", "name": "Data Storage Servers", "emission": 1.25, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        
        // --- CSM: Computer New Data ---
        {"category": "Computer, print and audio", "college": "CSM", "name": "Desktops, Thin Clients, Screens, Laptops and VOIP Phones", "emission": 0, "unit": "", "date": "2023", "notes": "Header"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Standard Desktop PC", "emission": 255431, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Thin Client Terminals", "emission": 0, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Non-Standard PCs", "emission": 44888, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Screens", "emission": 142800, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Laptops", "emission": 65375, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "VOIP Desktop Phones", "emission": 1918.22, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Related Energy Usage", "emission": 510412, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Carbon Impact Energy Usage", "emission": 92.49, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Smartphones & Tablets", "emission": 0, "unit": "", "date": "2023", "notes": "Header"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Smartphones", "emission": 865, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Tablets", "emission": 3649, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Related Energy Usage", "emission": 4514, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Carbon Impact", "emission": 0.82, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Printers", "emission": 0, "unit": "", "date": "2023", "notes": "Header"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Laserjet Printers", "emission": 23410, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Related Energy Usage", "emission": 23410, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Carbon Impact", "emission": 4.24, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Operational Activities", "emission": 0, "unit": "", "date": "2023", "notes": "Header"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Estimated Scope 1 & 2 carbon impact", "emission": 0, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Estimated Scope 3 carbon impact", "emission": 0, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Scope 1, 2 and 3", "emission": 0, "unit": "tCO2e", "date": "2023", "notes": "Operational"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Embodied Carbon Estimate", "emission": 0, "unit": "", "date": "2023", "notes": "Header"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Desktops, Thin Clients, Screens, Laptops", "emission": 139.27, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Smartphones & Tablets", "emission": 15.21, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Printers", "emission": 2.06, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Storage", "emission": 0, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Servers", "emission": 0, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Embodied Carbon Emissions", "emission": 156.54, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Totals", "emission": 0, "unit": "", "date": "2023", "notes": "Header"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total DMS Annualised Carbon Impact", "emission": 291.62, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Total Estimated Energy Usage per annum", "emission": 542979, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CSM", "name": "Estimated Total DMS Cost of Energy", "emission": 141174, "unit": "GBP", "date": "2023", "notes": "Total"},
        
        // --- LCF ---
        {"category": "Computer, print and audio", "college": "LCF", "name": "Standard Desktop PC", "emission": 404522, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Non-Standard PCs", "emission": 413606, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Screens", "emission": 247758, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Laptops", "emission": 92796, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "VOIP Desktop Phones", "emission": 1718.41, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Related Energy Usage", "emission": 1160401, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Carbon Impact", "emission": 201.5, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Smartphones", "emission": 763, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Tablets", "emission": 3219, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Related Energy Usage (Smartphones)", "emission": 3982, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Carbon Impact (Smartphones)", "emission": 0.69, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Laserjet Printers", "emission": 20856, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Related Energy Usage (Printers)", "emission": 20856, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Carbon Impact (Printers)", "emission": 3.62, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Desktops, Thin Clients Embodied", "emission": 251.7, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Smartphones & Tablets Embodied", "emission": 13.42, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Printers Embodied", "emission": 1.84, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Embodied Carbon", "emission": 266.95, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total DMS Annualised Carbon Impact", "emission": 557, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Total Estimated Energy Usage", "emission": 1192509, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCF", "name": "Estimated Total DMS Cost", "emission": 310052, "unit": "GBP", "date": "2023", "notes": "Total"},

        // --- LCC ---
        {"category": "Computer, print and audio", "college": "LCC", "name": "Standard Desktop PC", "emission": 359634, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Non-Standard PCs", "emission": 193444, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Screens", "emission": 187496, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Laptops", "emission": 64957, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "VOIP Desktop Phones", "emission": 1358.74, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Estimated Related Energy Usage", "emission": 806890, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Estimated Carbon Impact", "emission": 146.21, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Smartphones", "emission": 613, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Tablets", "emission": 2591, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Related Energy (Smartphones)", "emission": 3204, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Carbon Impact (Smartphones)", "emission": 0.58, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Laserjet Printers", "emission": 13620, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Related Energy (Printers)", "emission": 13620, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Carbon Impact (Printers)", "emission": 2.47, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Desktops Embodied", "emission": 182.14, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Smartphones Embodied", "emission": 10.79, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Printers Embodied", "emission": 1.2, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Estimated Embodied Carbon", "emission": 194.13, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total DMS Annualised Carbon Impact", "emission": 391.07, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Total Estimated Energy Usage", "emission": 829125, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "LCC", "name": "Estimated Total DMS Cost", "emission": 215573, "unit": "GBP", "date": "2023", "notes": "Total"},

        // --- CCW ---
        {"category": "Computer, print and audio", "college": "CCW", "name": "Standard Desktop PC", "emission": 270394, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Non-Standard PCs", "emission": 0, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Screens", "emission": 146656, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Laptops", "emission": 53755, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "VOIP Desktop Phones", "emission": 2158, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Estimated Related Energy Usage", "emission": 472962, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Estimated Carbon Impact", "emission": 85.7, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Smartphones", "emission": 978, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Tablets", "emission": 4108, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Related Energy (Smartphones)", "emission": 5087, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Carbon Impact (Smartphones)", "emission": 0.92, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Laserjet Printers", "emission": 25964, "unit": "kWh", "date": "2023", "notes": "Power Usage"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Related Energy (Printers)", "emission": 25964, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Carbon Impact (Printers)", "emission": 4.7, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Desktops Embodied", "emission": 129.21, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Smartphones Embodied", "emission": 17.15, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Printers Embodied", "emission": 2.29, "unit": "tCO2e", "date": "2023", "notes": "Embodied"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Estimated Embodied Carbon", "emission": 148.65, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total DMS Annualised Carbon Impact", "emission": 260.83, "unit": "tCO2e", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Total Estimated Energy Usage", "emission": 517407, "unit": "kWh", "date": "2023", "notes": "Total"},
        {"category": "Computer, print and audio", "college": "CCW", "name": "Estimated Total DMS Cost", "emission": 134526, "unit": "GBP", "date": "2023", "notes": "Total"}
    ];

    // üì∑ 18ÁßçÁ∫ØÊâãÂ∑•ÁªòÂà∂ÁöÑÁü¢ÈáèÁ∫øÁ®ø (SVG)
    const IMAGES = {
        email: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='10' y='30' width='80' height='50' fill='none' stroke='black' stroke-width='2'/><path d='M10,30 L50,60 L90,30' fill='none' stroke='black' stroke-width='2'/></svg>`,
        apple: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M30,30 Q15,30 15,50 Q15,80 40,90 Q50,95 60,90 Q85,80 85,50 Q85,30 70,30 Q60,30 50,40 Q40,30 30,30' fill='none' stroke='black' stroke-width='2'/><path d='M50,40 Q50,20 60,10' fill='none' stroke='black' stroke-width='2'/></svg>`,
        banana: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M20,20 Q60,80 90,40 Q85,35 80,40 Q50,70 25,25 Z' fill='none' stroke='black' stroke-width='2'/></svg>`,
        plastic_bottle: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='35' y='10' width='30' height='10' fill='black'/><path d='M35,20 L30,30 L30,90 L70,90 L70,30 L65,20 Z' fill='none' stroke='black' stroke-width='2'/></svg>`,
        coffee: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M20,30 L20,70 Q20,90 50,90 Q80,90 80,70 L80,30 Z' fill='none' stroke='black' stroke-width='2'/><path d='M80,40 Q95,40 95,50 Q95,60 80,60' fill='none' stroke='black' stroke-width='2'/><path d='M30,20 Q40,10 50,20' fill='none' stroke='black' stroke-width='1.5'/><path d='M50,20 Q60,10 70,20' fill='none' stroke='black' stroke-width='1.5'/></svg>`,
        toothpaste: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M80,80 L20,80 L20,60 Q20,30 30,30 L70,30 Q80,30 80,60 Z' fill='none' stroke='black' stroke-width='2'/><rect x='35' y='10' width='30' height='20' fill='none' stroke='black' stroke-width='2'/></svg>`,
        kettle: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M30,30 L70,30 L80,90 L20,90 Z' fill='none' stroke='black' stroke-width='2'/><path d='M70,40 Q90,40 90,60 L90,70 Q90,80 75,80' fill='none' stroke='black' stroke-width='2'/><path d='M30,30 Q50,10 70,30' fill='none' stroke='black' stroke-width='2'/></svg>`,
        burger: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M20,50 Q50,20 80,50' fill='none' stroke='black' stroke-width='2'/><rect x='20' y='55' width='60' height='10' fill='black'/><rect x='20' y='70' width='60' height='15' rx='5' fill='none' stroke='black' stroke-width='2'/></svg>`,
        tshirt: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M30,20 L10,30 L20,50 L30,40 L30,90 L70,90 L70,40 L80,50 L90,30 L70,20 Q50,35 30,20' fill='none' stroke='black' stroke-width='2'/></svg>`,
        sneakers: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M10,60 Q10,40 30,40 L70,40 Q90,40 90,60 L90,80 L10,80 Z' fill='none' stroke='black' stroke-width='2'/><path d='M30,40 L40,20 L60,20 L50,40' fill='none' stroke='black' stroke-width='2'/></svg>`,
        tree: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='45' y='70' width='10' height='20' fill='black'/><path d='M50,10 Q80,30 70,60 Q50,80 30,60 Q20,30 50,10' fill='none' stroke='black' stroke-width='2'/></svg>`,
        jeans: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M25,20 L75,20 L80,90 L50,85 L20,90 Z' fill='none' stroke='black' stroke-width='2'/><path d='M50,40 L50,85' fill='none' stroke='black' stroke-width='2'/></svg>`,
        smartphone: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='30' y='10' width='40' height='80' rx='5' fill='none' stroke='black' stroke-width='2'/><rect x='35' y='20' width='30' height='50' fill='none' stroke='black' stroke-width='1'/><circle cx='50' cy='80' r='3' fill='black'/></svg>`,
        steak: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M20,40 Q30,20 60,30 Q80,20 80,50 Q80,80 50,80 Q20,70 20,40' fill='none' stroke='black' stroke-width='2'/><path d='M30,50 L40,60' fill='none' stroke='black' stroke-width='1'/></svg>`,
        washing_machine: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='20' y='20' width='60' height='70' fill='none' stroke='black' stroke-width='2'/><circle cx='50' cy='55' r='20' fill='none' stroke='black' stroke-width='2'/><path d='M20,35 L80,35' fill='none' stroke='black' stroke-width='1'/></svg>`,
        laptop: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='20' y='20' width='60' height='40' fill='none' stroke='black' stroke-width='2'/><path d='M10,70 L90,70 L80,60 L20,60 Z' fill='none' stroke='black' stroke-width='2'/></svg>`,
        car: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M10,60 L20,40 L80,40 L90,60 L90,80 L10,80 Z' fill='none' stroke='black' stroke-width='2'/><circle cx='25' cy='80' r='8' fill='black'/><circle cx='75' cy='80' r='8' fill='black'/></svg>`,
        plane: `data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><path d='M10,50 L40,50 L50,20 L60,20 L60,50 L90,50 L95,60 L60,60 L60,80 L50,80 L40,60 L10,60 Z' fill='black'/></svg>`
    };
    
    const TRASH_SVGS = [
        `<svg viewBox="0 0 50 50"><rect x="5" y="5" width="40" height="40" fill="none" transform="rotate(5 25 25)"/><rect x="8" y="8" width="30" height="30" fill="none" stroke-dasharray="2,2"/></svg>`,
        `<svg viewBox="0 0 50 50"><path d="M25,5 Q45,5 45,25 Q45,45 25,40 Q5,45 5,25 Q5,5 25,5 M20,20 L30,30" fill="none"/></svg>`,
        `<svg viewBox="0 0 50 50"><polyline points="5,45 15,10 35,40 45,5" fill="none"/></svg>`,
        `<svg viewBox="0 0 50 50"><ellipse cx="25" cy="25" rx="15" ry="12" fill="none"/><path d="M25,13 L25,5" stroke="#000"/></svg>`
    ];

    // 1. Bio-Indicator: Recursive Wither Tree & Stacking Leaves
    const treeSys = {
        svg: document.getElementById('tree-svg'),
        canvas: document.getElementById('leaf-canvas'),
        ctx: document.getElementById('leaf-canvas').getContext('2d'),
        pileCanvas: document.getElementById('pile-canvas'),
        pileCtx: document.getElementById('pile-canvas').getContext('2d'),
        leaves: [],
        groundLevels: [], // ËÆ∞ÂΩïÂú∞Èù¢Â†ÜÁßØÈ´òÂ∫¶
        width: 0, height: 0,
        columnSize: 5, // Â†ÜÁßØÁ≤æÂ∫¶
        
        init: function() {
            this.resize();
            window.addEventListener('resize', () => this.resize());
            this.drawTree(1); 
            this.loop();
        },
        
        resize: function() {
            this.width = window.innerWidth;
            this.height = window.innerHeight;
            this.canvas.width = this.width;
            this.canvas.height = this.height;
            this.pileCanvas.width = this.width;
            this.pileCanvas.height = this.height;
            this.svg.setAttribute('viewBox', `0 0 ${this.width} ${this.height}`);
            this.groundLevels = new Float32Array(Math.ceil(this.width / this.columnSize));
        },

        // ÈÄíÂΩíÁîüÊàêÊ†ë
        drawTree: function(health) {
            this.svg.innerHTML = '';
            
            // Ê†ëÁöÑ‰ΩçÁΩÆÔºöÂ±èÂπïÂ∑¶‰æß 1/3 Â§Ñ
            const startX = this.width * 0.3; 
            const startY = this.height;
            
            // Ê†ëÁöÑÈ´òÂ∫¶ÔºöÈ°∂Âà∞Â±èÂπïÈ°∂ÈÉ®
            const trunkLen = this.height * 0.4;
            
            const angleVar = 30 * health + (1 - health) * 120; 
            
            let pathString = "";
            const generateBranch = (x, y, len, ang, depth) => {
                if (depth === 0) return;
                
                const x2 = x + len * Math.cos((ang - 90) * Math.PI / 180);
                const y2 = y + len * Math.sin((ang - 90) * Math.PI / 180);
                
                pathString += `M${x},${y} L${x2},${y2} `;
                
                const subLen = len * 0.75;
                generateBranch(x2, y2, subLen, ang - angleVar, depth - 1);
                generateBranch(x2, y2, subLen, ang + angleVar, depth - 1);
            };

            generateBranch(startX, startY, trunkLen, 90, 10); 
            
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", pathString);
            path.setAttribute("fill", "none");
            path.setAttribute("stroke", health > 0.3 ? "#000" : "#444");
            path.setAttribute("stroke-width", "1.5");
            path.setAttribute("vector-effect", "non-scaling-stroke");
            this.svg.appendChild(path);
        },

        // ÁîüÊàêÊ†ëÂè∂
        spawnLeaf: function(rate) {
            if (Math.random() < rate) {
                this.leaves.push({
                    x: Math.random() * this.width,
                    y: -10,
                    vx: (Math.random() - 0.5) * 3,
                    vy: 2 + Math.random() * 4, 
                    size: 4 + Math.random() * 6,
                    rot: Math.random() * 360,
                    vRot: (Math.random() - 0.5) * 10,
                    sway: Math.random() * 0.1,
                    color: `rgba(0,0,0,${0.5 + Math.random()*0.5})` 
                });
            }
        },

        loop: function() {
            this.ctx.clearRect(0, 0, this.width, this.height);
            
            for (let i = this.leaves.length - 1; i >= 0; i--) {
                let l = this.leaves[i];
                l.x += l.vx + Math.sin(l.y * 0.01) * l.sway * 20; 
                l.y += l.vy;
                l.rot += l.vRot;
                
                let col = Math.floor(l.x / this.columnSize);
                if (col >= 0 && col < this.groundLevels.length) {
                    let groundY = this.height - this.groundLevels[col];
                    
                    if (l.y >= groundY) {
                        this.pileCtx.save();
                        this.pileCtx.translate(l.x, groundY); 
                        this.pileCtx.rotate(l.rot * Math.PI / 180);
                        this.pileCtx.fillStyle = l.color;
                        this.drawLeafShape(this.pileCtx, l.size);
                        this.pileCtx.restore();
                        
                        this.groundLevels[col] += l.size * 0.4; 
                        if(col > 0) this.groundLevels[col-1] += l.size * 0.1;
                        if(col < this.groundLevels.length-1) this.groundLevels[col+1] += l.size * 0.1;

                        this.leaves.splice(i, 1);
                        continue; 
                    }
                }

                this.ctx.save();
                this.ctx.translate(l.x, l.y);
                this.ctx.rotate(l.rot * Math.PI / 180);
                this.ctx.fillStyle = l.color;
                this.drawLeafShape(this.ctx, l.size);
                this.ctx.restore();
            }
            requestAnimationFrame(() => this.loop());
        },
        
        drawLeafShape: function(ctx, size) {
            ctx.beginPath();
            ctx.moveTo(0, -size);
            ctx.quadraticCurveTo(size, 0, 0, size);
            ctx.quadraticCurveTo(-size, 0, 0, -size);
            ctx.fill();
        }
    };

    // 2. Audio System
    const audioSys = {
        ctx: null, droneOsc: null, gainNode: null,
        init: function() { if(!this.ctx) this.ctx = new (window.AudioContext||window.webkitAudioContext)(); },
        startDrone: function() {
            if(!this.ctx) this.init(); if(this.ctx.state==='suspended') this.ctx.resume();
            if(!this.droneOsc) {
                this.droneOsc = this.ctx.createOscillator(); this.gainNode = this.ctx.createGain();
                this.droneOsc.type = 'sawtooth'; this.droneOsc.frequency.setValueAtTime(50, this.ctx.currentTime);
                const f = this.ctx.createBiquadFilter(); f.type='lowpass'; f.frequency.value=200;
                this.droneOsc.connect(f); f.connect(this.gainNode); this.gainNode.connect(this.ctx.destination);
                this.gainNode.gain.setValueAtTime(0.05, this.ctx.currentTime); this.droneOsc.start();
            } else { this.gainNode.gain.linearRampToValueAtTime(0.05, this.ctx.currentTime+1); }
        },
        stopDrone: function() { if(this.gainNode) this.gainNode.gain.linearRampToValueAtTime(0, this.ctx.currentTime+0.5); },
        playGlitch: function() {
            if(!this.ctx || state.mode!=='chaos') return;
            const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
            o.type='square'; o.frequency.setValueAtTime(100+Math.random()*500, this.ctx.currentTime);
            o.frequency.exponentialRampToValueAtTime(50, this.ctx.currentTime+0.1);
            g.gain.setValueAtTime(0.05, this.ctx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime+0.1);
            o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+0.1);
        },
        playClick: function() {
            if(!this.ctx || state.mode==='chaos') return;
            const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
            o.frequency.value=800; g.gain.setValueAtTime(0.02, this.ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime+0.05);
            o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime+0.05);
        }
    };

    // 3. Hover Card Controller
    const hoverCard = {
        el: document.getElementById('hover-card'), img: document.getElementById('card-img'),
        valText: document.getElementById('card-val'), descText: document.getElementById('card-desc'),
        
        show: function(val, e) {
            let options = [];
            if (val < 0.001) {
                options = [{type:'email', factor:0.000004, label:'Emails Sent'}, {type:'apple', factor:0.00005, label:'Apples Produced'}, {type:'banana', factor:0.00008, label:'Bananas Produced'}];
            } else if (val < 0.05) {
                options = [{type:'plastic_bottle', factor:0.00008, label:'Plastic Bottles'}, {type:'coffee', factor:0.0002, label:'Cups of Coffee'}, {type:'toothpaste', factor:0.0005, label:'Tubes of Toothpaste'}, {type:'kettle', factor:0.015, label:'Kettles Boiled'}];
            } else if (val < 0.5) {
                options = [{type:'burger', factor:0.004, label:'Beef Burgers'}, {type:'tshirt', factor:0.007, label:'Cotton T-Shirts'}, {type:'sneakers', factor:0.014, label:'Pairs of Sneakers'}, {type:'tree', factor:0.025, label:'Trees (Yearly Absorption)'}, {type:'jeans', factor:0.033, label:'Pairs of Jeans'}];
            } else if (val < 2.0) {
                options = [{type:'smartphone', factor:0.06, label:'Smartphones Produced'}, {type:'steak', factor:0.07, label:'Steak Dinners'}, {type:'washing_machine', factor:0.1, label:'Washing Cycles (Hot)'}, {type:'laptop', factor:0.3, label:'Laptops Produced'}];
            } else {
                options = [{type:'car', factor:0.17, label:'km Driven in Diesel Car'}, {type:'plane', factor:0.9, label:'Flights LHR-NYC'}];
            }

            const choice = options[Math.floor(Math.random() * options.length)];
            let count = 0;
            if(choice.type === 'car') count = Math.ceil(val / 0.00017); 
            else { count = (val / choice.factor).toFixed(1); if (count > 100) count = Math.ceil(count); }

            this.img.src = IMAGES[choice.type]; 
            this.valText.textContent=`${val.toFixed(4)} tCO‚ÇÇe`;
            this.descText.textContent=`‚âà ${count} ${choice.label}`; 
            this.el.classList.add('visible'); 
            this.move(e);
        },
        
        hide: function() { this.el.classList.remove('visible'); },
        move: function(e) {
            let x=e.clientX+20, y=e.clientY+20;
            if(x+240>window.innerWidth) x=e.clientX-250; if(y+260>window.innerHeight) y=e.clientY-270;
            this.el.style.left=x+'px'; this.el.style.top=y+'px';
        }
    };

    // 4. Energy Tracker & Simulation Logic
    class EnergyTracker {
        constructor() { this.j=0; this.last=Date.now(); this.trash=0; this.health = 1.0; this.loop(); }
        
        loop() {
            setInterval(()=>{
                let now=Date.now(), dt=(now-this.last)/1000; this.last=now;
                this.add(1.5*dt); // Base power consumption
                
                // --- BIO-INDICATOR UPDATE ---
                if (state.mode === 'chaos') {
                    const MAX_TOLERANCE = 300; 
                    this.health = Math.max(0, 1 - (this.j / MAX_TOLERANCE));
                    
                    treeSys.drawTree(this.health);
                    
                    const fallRate = 0.02 + (1 - this.health) * 0.9;
                    treeSys.spawnLeaf(fallRate);
                    
                    document.getElementById('trash-count-label').textContent = `Energy Waste: ${this.trash} | Tree Vitality: ${(this.health*100).toFixed(0)}%`;
                }
                
                if(this.getCarbon()/0.05 > this.trash) { this.spawnTrash(); this.trash++; }
            },100);
        }
        
        add(v) { this.j+=v; document.getElementById('energy-joules').textContent=this.j.toFixed(2)+' J'; document.getElementById('energy-carbon').textContent=this.getCarbon().toFixed(4)+' gCO‚ÇÇe'; }
        getCarbon() { return this.j*0.00015; }
        
        spawnTrash() {
            if(state.mode!=='chaos') return;
            const d=document.createElement('div'); d.className='trash-item';
            d.innerHTML=TRASH_SVGS[Math.floor(Math.random()*TRASH_SVGS.length)];
            d.style.left=Math.random()*90+'%'; d.style.top='-50px';
            d.style.transform=`rotate(${Math.random()*360}deg) scale(${0.8+Math.random()})`;
            document.getElementById('trash-container').appendChild(d);
            setTimeout(()=>{ d.style.top=(85+Math.random()*10)+'%'; },50);
            audioSys.playGlitch();
        }
    }
    
    // 5. Main App Logic
    const state = { mode: 'order', category: null, college: null, search: "" };
    const dom = {
        navTree: document.getElementById('nav-tree'), dataList: document.getElementById('data-list'),
        header: document.getElementById('content-header-wrapper'), empty: document.getElementById('empty-state'),
        search: document.getElementById('search-input'), toggle: document.getElementById('mode-toggle')
    };

    function init() {
        treeSys.init(); 
        const energy = new EnergyTracker();

        const cats=[...new Set(RAW_DATA.map(d=>d.category))], cols=["CSM","LCF","LCC","CCW"];
        dom.navTree.innerHTML='';
        cats.forEach(c=>{
            const div=document.createElement('div'); div.className='acc-item';
            const count = RAW_DATA.filter(d=>d.category===c && d.emission > 0).length;
            div.innerHTML=`<div class="acc-header" onclick="this.parentNode.classList.toggle('open')"><span>${c}</span><span>+</span></div><div class="acc-body"></div>`;
            const body=div.querySelector('.acc-body');
            cols.forEach(col=>{
                const n=RAW_DATA.filter(d=>d.category===c&&d.college===col && d.emission>0).length;
                const i=document.createElement('div'); i.className='college-item';
                i.innerHTML=`<span>${col}</span><span style="font-size:10px">${n}</span>`;
                i.onclick=()=>{ load(c,col); document.querySelectorAll('.college-item').forEach(x=>x.classList.remove('active')); i.classList.add('active'); };
                body.appendChild(i);
            });
            dom.navTree.appendChild(div);
        });

        dom.search.addEventListener('input', e=>{ state.search=e.target.value.toLowerCase(); if(state.category) render(); });
        dom.toggle.addEventListener('click', toggleMode);
        
        window.addEventListener('mousemove', ()=>{ if(Math.random()>0.8) energy.add(0.05); });
        window.addEventListener('click', ()=>{ energy.add(0.2); });
        document.getElementById('scroll-container').addEventListener('scroll', ()=>{ energy.add(0.5); });

        initNoise();
    }

    function load(c, col) { state.category=c; state.college=col; dom.empty.style.display='none'; render(); }

    function render() {
        let d=RAW_DATA.filter(x=>x.category===state.category&&x.college===state.college);
        if(state.search) d=d.filter(x=>x.name.toLowerCase().includes(state.search));
        
        const t=d.filter(x => x.unit === "tCO2e" && x.name.indexOf("Total") === -1).reduce((a,b)=>a+b.emission,0);
        
        dom.header.innerHTML=`<div><div style="font-size:11px;color:#666;">${state.category}/${state.college}</div><div style="font-size:24px">Emission Report</div></div>
        <div class="stats-grid"><div class="stat-box"><span>NET IMPACT</span> <strong>${t.toFixed(2)} t</strong></div><div class="stat-box"><span>ITEMS</span> <strong>${d.length}</strong></div></div>`;

        dom.dataList.innerHTML='';
        d.forEach(x=>{
            const row=document.createElement('div'); row.className='data-row';
            let valDisplay = x.emission.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 4});
            if (x.unit === 'GBP') { valDisplay = '¬£ ' + valDisplay; } else if (x.unit) { valDisplay += ` <span style="font-size:0.8em;opacity:0.5">${x.unit}</span>`; }
            
            const isHeader = x.notes === "Header";
            const style = isHeader ? "color:#999;font-style:italic;" : "";
            
            row.innerHTML=`<div style="font-weight:500;${style}">${x.name}</div><div class="cell-emission" style="${style}">${valDisplay}</div><div>${x.date}</div><div style="color:#666;font-style:italic">${x.notes}</div>`;
            
            row.addEventListener('mouseenter', e=>{ 
                if(state.mode!=='chaos' && x.emission > 0) {
                    let calcVal = x.emission;
                    if(x.unit === 'kWh') calcVal = x.emission * 0.000193; 
                    if(x.unit === 'GBP') calcVal = x.emission * 0.0002; 
                    hoverCard.show(calcVal, e); 
                    audioSys.playClick(); 
                } 
            });
            row.addEventListener('mousemove', e=>{ if(state.mode!=='chaos') hoverCard.move(e); });
            row.addEventListener('mouseleave', ()=>{ hoverCard.hide(); });
            
            dom.dataList.appendChild(row);
        });

        if(state.mode==='chaos') setTimeout(randomizeRows, 50);
    }

    function toggleMode() {
        audioSys.init();
        if(state.mode==='order') {
            state.mode='chaos'; document.body.classList.add('mode-chaos');
            document.getElementById('mode-text').textContent="Return to Order";
            hoverCard.hide(); randomizeRows(); audioSys.startDrone();
        } else {
            state.mode='order'; document.body.classList.remove('mode-chaos');
            document.getElementById('mode-text').textContent="Enter Landfill";
            resetRows(); audioSys.stopDrone();
        }
    }

    function randomizeRows() {
        document.querySelectorAll('.data-row').forEach(row=>{
            const rot=(Math.random()-0.5)*40, tx=(Math.random()-0.5)*100, ty=Math.random()*300;
            row.style.transform=`translate(${tx}px,${ty}px) rotate(${rot}deg)`;
        });
    }
    function resetRows() { document.querySelectorAll('.data-row').forEach(r=>{ r.style.transform=''; }); }

    function initNoise() {
        const c=document.getElementById('noise-canvas'), x=c.getContext('2d');
        const r=()=>{c.width=window.innerWidth;c.height=window.innerHeight}; window.onresize=r; r();
        const l=()=>{
            const d=x.createImageData(c.width,c.height), b=new Uint32Array(d.data.buffer);
            for(let i=0;i<b.length;i++)if(Math.random()<0.05)b[i]=0xff000000;
            x.putImageData(d,0,0); requestAnimationFrame(l);
        }; l();
    }

    init();
</script>
</body>
</html>
