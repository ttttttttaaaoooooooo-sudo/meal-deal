<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENTROPY ARCHIVE | ç†µå¢æ¡£æ¡ˆé¦†</title>
    <style>
        /* --- 0. åŸºç¡€è®¾ç½®ä¸å˜é‡ --- */
        :root {
            --bg-color: #F4F4F4;
            --ink-color: #111111;
            --accent-color: #333333;
            --grid-col: 1fr 120px 120px 80px;
            --font-sans: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-serif: 'Georgia', 'Times New Roman', serif;
            --transition-speed: 0.8s;
            --transition-ease: cubic-bezier(0.25, 1, 0.5, 1);
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--ink-color);
            font-family: var(--font-sans);
            overflow-x: hidden;
            /* å™ªç‚¹èƒŒæ™¯ */
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            transition: background-color 0.5s;
        }

        /* --- 1. UI æ§åˆ¶é¢æ¿ (Sticky) --- */
        header {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 300px;
            background: rgba(244, 244, 244, 0.9);
            backdrop-filter: blur(5px);
            border: 1px solid var(--ink-color);
            padding: 15px;
            z-index: 1000;
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }

        h1 {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin: 0;
        }

        button#toggleMode {
            background: var(--ink-color);
            color: var(--bg-color);
            border: none;
            padding: 5px 10px;
            font-family: var(--font-mono);
            font-size: 12px;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        button#toggleMode:hover {
            background: #444;
            transform: translateY(-1px);
        }

        .metrics {
            font-family: 'Courier New', Courier, monospace;
            font-size: 11px;
            line-height: 1.6;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
        }

        .energy-bar-container {
            width: 100%;
            height: 4px;
            background: #ddd;
            margin-top: 5px;
            position: relative;
        }

        .energy-bar-fill {
            height: 100%;
            background: var(--ink-color);
            width: 0%;
            transition: width 0.1s linear;
        }

        .waste-log {
            margin-top: 10px;
            border-top: 1px dashed #999;
            padding-top: 5px;
            font-style: italic;
            color: #555;
            min-height: 1.5em;
        }

        /* --- 2. åˆ—è¡¨å®¹å™¨ --- */
        #archive-container {
            padding: 120px 40px 40px 340px; /*ç•™å‡ºå·¦ä¸Šè§’headerç©ºé—´*/
            min-height: 100vh;
            position: relative;
            /* 3Dé€è§†ï¼Œä¸ºåƒåœ¾åœºæ¨¡å¼åšå‡†å¤‡ */
            perspective: 1000px; 
        }

        /* åˆ—è¡¨è¡¨å¤´ - ä»…åœ¨å›¾ä¹¦é¦†æ¨¡å¼æ˜¾ç¤º */
        .list-header {
            display: grid;
            grid-template-columns: var(--grid-col);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--ink-color);
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            position: sticky;
            top: 0;
            opacity: 1;
            transition: opacity 0.5s;
        }

        /* --- 3. æ¡ç›®æ ·å¼ (Item) --- */
        .item {
            position: relative;
            background: var(--bg-color);
            border-bottom: 1px solid #e0e0e0;
            font-size: 13px;
            height: 40px;
            display: grid;
            grid-template-columns: var(--grid-col);
            align-items: center;
            transition: 
                transform var(--transition-speed) var(--transition-ease),
                box-shadow var(--transition-speed) var(--transition-ease),
                border var(--transition-speed) var(--transition-ease),
                background var(--transition-speed);
            transform-origin: center center;
            will-change: transform;
        }

        .item:hover {
            background: #fff;
        }

        .item span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 10px;
        }

        .col-id { font-family: 'Courier New', monospace; color: #666; }
        .col-title { font-family: var(--font-serif); letter-spacing: 0.5px; }
        .col-type { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .col-size { text-align: right; font-family: monospace; }

        /* --- 4. åƒåœ¾åœºæ¨¡å¼ (Waste Mode) --- */
        body.mode-waste {
            background-color: #E8E8E8; /* ç•¥å¾®å˜è„ */
            overflow-y: auto; /* å…è®¸æ»šåŠ¨ */
        }

        body.mode-waste .list-header {
            opacity: 0;
            pointer-events: none;
        }

        /* åƒåœ¾åœºæ¨¡å¼ä¸‹çš„æ¡ç›®å˜å½¢ */
        body.mode-waste .item {
            /* æ ¸å¿ƒï¼šè¦†ç›–Gridå¸ƒå±€ï¼Œå˜æˆç»å¯¹å®šä½å †å  */
            display: flex; 
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            padding: 10px;
            height: auto;
            width: 200px; /* å¡ç‰‡åŒ– */
            border: 1px solid var(--ink-color);
            background: #fff;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.15);
            
            /* ä½ç½®å°†ç”± JS åŠ¨æ€æ³¨å…¥ CSS var æ§åˆ¶ */
            position: absolute; 
            left: 50%; /* å±…ä¸­å †å  */
            top: 200px; /* èµ·å§‹å †å ç‚¹ */
            
            /* åº”ç”¨é¢„è®¡ç®—çš„æ··æ²Œå˜æ¢ */
            transform: 
                translate(var(--waste-x), var(--waste-y)) 
                rotate(var(--waste-r)) 
                scale(var(--waste-s));
            
            z-index: var(--z-index);
        }
        
        body.mode-waste .item span {
            display: block;
            width: 100%;
            margin-bottom: 4px;
        }
        
        body.mode-waste .col-title {
            font-weight: bold;
            font-size: 14px;
            white-space: normal;
        }

        /* --- 5. å®ä½“åŒ–åƒåœ¾ (Mapping Objects) --- */
        /* è¿™äº›æ˜¯ç‰¹æ®Šçš„ itemï¼Œåªæœ‰åœ¨è¾¾åˆ°èƒ½è€—é˜ˆå€¼æ—¶ç”Ÿæˆ */
        .item.physical-waste {
            background: var(--ink-color);
            color: var(--bg-color);
            border: none;
        }
        
        .item.physical-waste .col-id { color: #888; }

        /* åŠ è½½æŒ‡ç¤ºå™¨ */
        .loader {
            text-align: center;
            padding: 20px;
            font-family: monospace;
            opacity: 0.5;
        }

    </style>
</head>
<body>

    <header>
        <div class="panel-header">
            <h1>Energy Auditor v1.0</h1>
            <button id="toggleMode">Switch View</button>
        </div>
        <div class="metrics">
            <div class="metric-row">
                <span>SESSION TIME:</span>
                <span id="timeDisplay">00:00</span>
            </div>
            <div class="metric-row">
                <span>SCROLL DIST:</span>
                <span id="scrollDisplay">0 px</span>
            </div>
            <div class="metric-row">
                <span>EST. POWER:</span>
                <span id="powerDisplay">0 W</span>
            </div>
            <div class="metric-row" style="margin-top:10px; font-weight:bold;">
                <span>TOTAL ENERGY:</span>
                <span id="energyDisplay">0.0000 Wh</span>
            </div>
            <div class="energy-bar-container">
                <div class="energy-bar-fill" id="energyBar"></div>
            </div>
            <div class="waste-log" id="wasteLog">
                System initializing...
            </div>
        </div>
    </header>

    <div id="archive-container">
        <div class="list-header">
            <span>Entry Title / Description</span>
            <span>Ref. ID</span>
            <span>Category</span>
            <span>Size</span>
        </div>
        <div id="items-wrapper"></div>
        <div class="loader">Loading Data Fragments...</div>
    </div>

<script>
/**
 * åˆ›æ„æŠ€æœ¯æ ¸å¿ƒé€»è¾‘
 * 1. DataGenerator: ç”Ÿæˆè™šæ„çš„æ¡£æ¡ˆæ•°æ®
 * 2. EnergySystem: ç‰©ç†èƒ½è€—ä¼°ç®—
 * 3. Renderer: DOM æ“ä½œä¸æ¨¡å¼åˆ‡æ¢
 */

// --- é…ç½®å‚æ•° ---
const CONFIG = {
    basePower: 15, // åŸºç¡€åŠŸç‡ (Watts) - æ¨¡æ‹Ÿå±å¹•+CPUå¾…æœº
    scrollFactor: 0.5, // æ»šåŠ¨é˜»åŠ›ç³»æ•° (Watts per px/ms)
    domCost: 0.05, // æ¯ä¸ªDOMèŠ‚ç‚¹çš„é¢å¤–æ¸²æŸ“åŠŸç‡
    thresholds: [
        { val: 0.005, name: "LED Blink", icon: "â™¦" },
        { val: 0.1, name: "Google Search", icon: "G" },
        { val: 1.0, name: "Light Bulb (1h)", icon: "ğŸ’¡" },
        { val: 5.0, name: "Smartphone Charge", icon: "ğŸ“±" },
        { val: 150.0, name: "Boil Kettle", icon: "â™¨ï¸" }
    ]
};

// --- çŠ¶æ€ç®¡ç† ---
const state = {
    mode: 'library', // 'library' or 'waste'
    startTime: Date.now(),
    lastFrameTime: Date.now(),
    totalEnergy: 0, // Joules
    scrollDistance: 0,
    lastScrollY: 0,
    itemCount: 0,
    wasteObjects: [] // è®°å½•å·²ç”Ÿæˆçš„åƒåœ¾å¯¹è±¡
};

// --- 1. æ•°æ®ç”Ÿæˆå™¨ (Mock Data) ---
const words = ["Entropy", "Decay", "Archive", "System", "Vector", "Null", "Reference", "Grid", "Signal", "Noise", "Structure", "Chaos", "Memory", "Cache", "Fragment", "Index"];
const types = ["DOC", "IMG", "WAV", "DAT", "LOG", "ERR"];

function generateItemData(index) {
    const title = `${words[Math.floor(Math.random()*words.length)]} ${words[Math.floor(Math.random()*words.length)]} ${Math.floor(Math.random()*99)}`;
    const id = `REF-${10000 + index}`;
    const type = types[Math.floor(Math.random()*types.length)];
    const size = `${(Math.random() * 5).toFixed(2)} MB`;
    
    // é¢„è®¡ç®—åƒåœ¾åœºæ¨¡å¼ä¸‹çš„åæ ‡ (Deterministic Chaos)
    // è¿™æ ·åˆ‡æ¢æ¨¡å¼æ—¶ï¼Œå®ƒä»¬æ€»æ˜¯é£åˆ°åŒä¸€ä¸ªä¹±ç³Ÿç³Ÿçš„åœ°æ–¹
    const randomX = (Math.random() - 0.5) * 800; // æ°´å¹³æ•£å¸ƒ
    const randomY = index * 10 + (Math.random() - 0.5) * 100; // å‚ç›´æ•£å¸ƒï¼Œéšindexå¢åŠ å¾€ä¸‹
    const randomR = (Math.random() - 0.5) * 60; // æ—‹è½¬è§’åº¦
    const randomS = 0.8 + Math.random() * 0.4; // ç¼©æ”¾
    
    return { title, id, type, size, randomX, randomY, randomR, randomS, index };
}

// --- 2. æ¸²æŸ“å¼•æ“ ---
const itemsWrapper = document.getElementById('items-wrapper');
const toggleBtn = document.getElementById('toggleMode');
const wasteLog = document.getElementById('wasteLog');

function createDOMItem(data, isSpecial = false) {
    const el = document.createElement('div');
    el.className = isSpecial ? 'item physical-waste' : 'item';
    
    // è®¾ç½® CSS å˜é‡ç”¨äºåƒåœ¾åœºæ¨¡å¼çš„å˜æ¢
    el.style.setProperty('--waste-x', `${data.randomX}px`);
    // åœ¨åƒåœ¾æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„ top è®¾ä¸º relative to a stack centerï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ translateY æ¨¡æ‹Ÿ
    // ä¸ºäº†è®©å®ƒä»¬åœ¨ library æ¨¡å¼ä¸‹æ­£å¸¸ï¼Œæˆ‘ä»¬åœ¨ CSS é‡Œé»˜è®¤æ˜¯ grid
    // è¿™é‡Œçš„ waste-y æ˜¯ç›¸å¯¹äºå †å èµ·ç‚¹çš„åç§»
    el.style.setProperty('--waste-y', `${data.randomY}px`); 
    el.style.setProperty('--waste-r', `${data.randomR}deg`);
    el.style.setProperty('--waste-s', `${data.randomS}`);
    el.style.setProperty('--z-index', Math.floor(Math.random() * 100));

    // å†…éƒ¨ç»“æ„
    el.innerHTML = `
        <span class="col-title">${data.title}</span>
        <span class="col-id">${data.id}</span>
        <span class="col-type">${data.type}</span>
        <span class="col-size">${data.size}</span>
    `;
    
    return el;
}

function appendItems(count) {
    const fragment = document.createDocumentFragment();
    for (let i = 0; i < count; i++) {
        const data = generateItemData(state.itemCount++);
        const el = createDOMItem(data);
        fragment.appendChild(el);
    }
    itemsWrapper.appendChild(fragment);
}

// åˆå§‹åŒ–å…ˆåŠ è½½50ä¸ª
appendItems(50);

// --- 3. äº¤äº’ä¸æ¨¡å¼åˆ‡æ¢ ---
toggleBtn.addEventListener('click', () => {
    state.mode = state.mode === 'library' ? 'waste' : 'library';
    document.body.classList.toggle('mode-waste');
    
    if(state.mode === 'waste') {
        toggleBtn.innerText = "Back to Order";
        wasteLog.innerText = ">> COLLAPSING STRUCTURE...";
        // åƒåœ¾åœºæ¨¡å¼ä¸‹ï¼Œä¸ºäº†çœ‹æ¸…å †å ï¼Œæˆ‘ä»¬éœ€è¦é‡ç½®ä¸€ä¸‹å®¹å™¨çš„é«˜åº¦ï¼Œæˆ–è€…è®©bodyæ»šåŠ¨
    } else {
        toggleBtn.innerText = "View Entropy";
        wasteLog.innerText = ">> RESTORING GRID...";
    }
});

// --- 4. æ— é™æ»šåŠ¨é€»è¾‘ ---
window.addEventListener('scroll', () => {
    const scrollTop = window.scrollY;
    state.scrollDistance += Math.abs(scrollTop - state.lastScrollY);
    state.lastScrollY = scrollTop;

    // ç®€å•çš„æ— é™åŠ è½½æ£€æµ‹
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500) {
        // é™åˆ¶æœ€å¤§èŠ‚ç‚¹æ•°ä»¥ä¿æŠ¤æµè§ˆå™¨æ€§èƒ½ (æ¨¡æ‹Ÿå†…å­˜é™åˆ¶)
        if (state.itemCount < 500) { 
            appendItems(20);
        }
    }
});

// --- 5. æ ¸å¿ƒï¼šèƒ½è€—ç³»ç»Ÿå¾ªç¯ (Energy Loop) ---
const els = {
    time: document.getElementById('timeDisplay'),
    scroll: document.getElementById('scrollDisplay'),
    power: document.getElementById('powerDisplay'),
    energy: document.getElementById('energyDisplay'),
    bar: document.getElementById('energyBar')
};

function formatTime(ms) {
    const s = Math.floor(ms / 1000);
    const m = Math.floor(s / 60);
    return `${m.toString().padStart(2, '0')}:${(s % 60).toString().padStart(2, '0')}`;
}

function checkThresholds(currentWh) {
    // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç”Ÿæˆâ€œå®ä½“åƒåœ¾â€çš„é˜ˆå€¼
    CONFIG.thresholds.forEach(t => {
        if (currentWh >= t.val && !state.wasteObjects.includes(t.name)) {
            state.wasteObjects.push(t.name);
            spawnPhysicalWaste(t);
        }
    });
}

function spawnPhysicalWaste(threshold) {
    // ç”Ÿæˆä¸€ä¸ªç‰¹æ®Šçš„ã€é»‘è‰²çš„ã€æ²‰é‡çš„å—
    const specialData = generateItemData(state.itemCount++);
    specialData.title = `[WASTE] ${threshold.name.toUpperCase()}`;
    specialData.type = "CO2";
    specialData.size = `${threshold.val} Wh`;
    // è®©å®ƒæ›´å¤§ã€æ›´é»‘
    specialData.randomS = 1.5; 
    
    const el = createDOMItem(specialData, true);
    
    // æ’å…¥åˆ°åˆ—è¡¨é¡¶éƒ¨æˆ–è€…éšæœºä½ç½®
    itemsWrapper.appendChild(el);
    
    // æ›´æ–°æ—¥å¿—
    wasteLog.innerText = `>> ALERT: Energy Cost equivalent to ${threshold.name} generated.`;
    wasteLog.style.color = "red";
    setTimeout(() => wasteLog.style.color = "#555", 2000);
}

function updateEnergy() {
    const now = Date.now();
    const dt = now - state.lastFrameTime; // æ¯«ç§’
    state.lastFrameTime = now;

    // 1. è®¡ç®—å½“å‰ç¬æ—¶åŠŸç‡ (Watts)
    // åŸºç¡€åŠŸç‡ + æ»šåŠ¨é€Ÿåº¦å¸¦æ¥çš„åŠŸç‡ + DOMèŠ‚ç‚¹å‹åŠ›
    // ç®€å•çš„é€Ÿåº¦è®¡ç®—ï¼šæœ€è¿‘ä¸€å¸§æ»šåŠ¨çš„è·ç¦» / æ—¶é—´
    // ä¸ºäº†å¹³æ»‘ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªè¡°å‡
    const scrollSpeed = Math.abs(state.lastScrollY - (state.prevScrollY || state.lastScrollY)) / (dt || 16); 
    state.prevScrollY = state.lastScrollY;

    const currentPower = CONFIG.basePower + (scrollSpeed * 100 * CONFIG.scrollFactor) + (state.itemCount * CONFIG.domCost);
    
    // 2. ç´¯åŠ èƒ½é‡ (Joules = Watts * Seconds)
    const joulesDelta = currentPower * (dt / 1000);
    state.totalEnergy += joulesDelta;

    // 3. è½¬æ¢ä¸º Wh (1 Wh = 3600 J)
    const wh = state.totalEnergy / 3600;

    // 4. æ›´æ–° UI
    els.time.innerText = formatTime(now - state.startTime);
    els.scroll.innerText = `${Math.floor(state.scrollDistance)} px`;
    els.power.innerText = `${currentPower.toFixed(1)} W`;
    els.energy.innerText = `${wh.toFixed(4)} Wh`;
    
    // è¿›åº¦æ¡æ¨¡æ‹Ÿ (å‡è®¾ 10Wh æ˜¯æ»¡æ¡)
    els.bar.style.width = `${Math.min((wh / 10) * 100, 100)}%`;

    // 5. è§¦å‘ç‰©ç†æ˜ å°„
    checkThresholds(wh);

    requestAnimationFrame(updateEnergy);
}

// å¯åŠ¨å¼•æ“
requestAnimationFrame(updateEnergy);

</script>
</body>
</html>
